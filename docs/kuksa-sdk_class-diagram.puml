@startuml
'https://plantuml.com/class-diagram

package grpc {

    ManagedChannelBuilder --> ManagedChannel

    class ManagedChannel
    class ManagedChannelBuilder

}

package kuksa {

    package proto {
        class Field
        class Datapoint
        class DataEntry
        class SetResponse
        class GetResponse
        class DataEntryError
    }

    DataBrokerConnector -down-> DataBrokerException
    DataBrokerConnector -down-> DataBrokerConnection
    DataBrokerConnection -down-> PropertyObserver
    DataBrokerConnection -down-> Property
    DataBrokerConnection -left-> DataBrokerException
    DataBrokerConnection -up-> MultiListener
    MultiListener -right-> DisconnectListener
    TimeoutConfig -left-* DataBrokerConnector

    class DataBrokerConnector {
        + connect(ManagedChannel): DataBrokerConnection
    }

    class TimeoutConfig {
        + timeout: Long
        + timeUnit: TimeUnit
    }

    class DataBrokerConnection {
        + disconnectListeners: MultiListener<DisconnectListener>
        + subscribe(List<Property>, PropertyObserver)
        + fetchProperty(Property): GetResponse
        + updateProperty(Property, Datapoint): SetResponse
        + disconnect()
    }
    
    interface PropertyObserver {
        + onPropertyChanged(vssPath: String, Types.DataEntry)
        + onError(Throwable)
    }

    class Property {
        + vssPath: String
        + types: List<Types.Field>
    }

    class DataBrokerException

    abstract class MultiListener<T> {
        + register(T)
        + unregister(T)
    }

    interface DisconnectListener {
        + onDisconnect()
    }
}

DataBrokerConnector -up-> ManagedChannel
DataBrokerConnection -right-> proto

@enduml
